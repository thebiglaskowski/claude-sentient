name: loop
version: 2.0.0
description: Run the autonomous development loop until all gates pass
command: cc-loop

category: execution
model: opus

aliases:
  - cc-auto
  - cc-run

arguments:
  - name: task
    type: string
    required: false
    description: Task description or focus area
    examples:
      - "implement user authentication"
      - "fix the checkout bug"
      - "security"
      - "testing"

flags:
  - name: max-iterations
    short: m
    type: number
    default: 50
    description: Maximum loop iterations

  - name: swarm
    short: s
    type: boolean
    default: false
    description: Enable swarm mode for many independent tasks

  - name: parallel
    short: p
    type: boolean
    default: true
    description: Enable parallel agent execution

  - name: pause-on
    type: string
    default: S0
    description: Pause for user on severity level (S0, S1, S2)

  - name: dry-run
    short: d
    type: boolean
    default: false
    description: Show what would be done without doing it

  - name: resume
    short: r
    type: boolean
    default: false
    description: Resume from saved state

invokes:
  - task-router
  - query-classifier
  - evaluator-optimizer
  - context-manager
  - gate-runner
  - checkpoint

examples:
  - description: Basic loop
    command: /cc-loop "implement user authentication"

  - description: Swarm mode for large review
    command: /cc-loop --swarm "review entire codebase"

  - description: Limited iterations
    command: /cc-loop --max-iterations=10 "fix failing tests"

  - description: Dry run
    command: /cc-loop --dry-run "refactor database layer"

content: |
  # Autonomous Development Loop

  Execute phases until all quality gates pass and work queue is empty.

  ## Process

  ```
  1. CLASSIFY    — Determine task type and orchestration mode
  2. CONTEXTUALIZE — Load relevant context
  3. ASSESS      — Evaluate current state
  4. PLAN        — Create/update work queue
  5. EXECUTE     — Implement changes
  6. VERIFY      — Run tests
  7. QUALITY     — Check all gates
  8. CHECKPOINT  — Commit verified work
  9. EVALUATE    — Check completion
  10. RECOVER    — Handle errors (if needed)
  ```

  ## Exit Conditions

  Loop exits when ALL of these are true:
  - All quality gates pass
  - Work queue is empty
  - 2 consecutive passing iterations
  - Verification iteration confirms stability

  ## Swarm Mode

  When --swarm is enabled:
  - Workers self-organize from task pool
  - No coordinator bottleneck
  - Automatic load balancing
  - Best for many independent tasks

  ## Quality Gates

  All gates are blocking:
  - Lint: 0 errors, 0 warnings
  - Type Check: 0 errors
  - Test Coverage: >= 80%
  - Security Scan: 0 S0/S1
  - Work Queue: 0 pending
  - Documentation: Complete
