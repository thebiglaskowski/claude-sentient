{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://claude-conductor.dev/schemas/skill.schema.json",
  "title": "Skill Definition",
  "description": "Schema for auto-triggered behavioral skills",
  "allOf": [
    { "$ref": "base.schema.json" }
  ],
  "type": "object",
  "required": ["triggers"],
  "properties": {
    "triggers": {
      "type": "array",
      "minItems": 1,
      "items": {
        "oneOf": [
          {
            "type": "string",
            "description": "Simple phrase trigger"
          },
          {
            "type": "object",
            "properties": {
              "pattern": {
                "type": "string",
                "description": "Regex pattern for complex matching"
              },
              "priority": {
                "type": "integer",
                "minimum": 0,
                "maximum": 100,
                "default": 50,
                "description": "Higher priority triggers win on conflict"
              },
              "exclusive": {
                "type": "boolean",
                "default": false,
                "description": "If true, other skills don't activate"
              }
            },
            "required": ["pattern"]
          }
        ]
      },
      "description": "Phrases or patterns that activate this skill"
    },
    "model": {
      "type": "string",
      "enum": ["haiku", "sonnet", "opus"],
      "default": "sonnet",
      "description": "Recommended model for this skill"
    },
    "depends": {
      "type": "object",
      "additionalProperties": {
        "type": "string",
        "pattern": "^[<>=^~]*\\d+\\.\\d+\\.\\d+$",
        "description": "Version constraint (e.g., >=1.0.0, ^2.0.0)"
      },
      "description": "Required skills with version constraints"
    },
    "provides": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Capabilities this skill provides"
    },
    "conflicts": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Skills that cannot be active simultaneously"
    },
    "subscribes": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "event": {
            "type": "string",
            "pattern": "^[a-z]+\\.[a-z]+\\.[a-z]+$",
            "description": "Event name to subscribe to"
          },
          "handler": {
            "type": "string",
            "description": "Handler function name in content"
          },
          "filter": {
            "type": "object",
            "description": "Optional filter for event payload"
          }
        },
        "required": ["event", "handler"]
      },
      "description": "Events this skill responds to"
    },
    "publishes": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^[a-z]+\\.[a-z]+\\.[a-z]+$"
      },
      "description": "Events this skill emits"
    },
    "config": {
      "type": "object",
      "description": "Configuration schema for this skill"
    },
    "content": {
      "type": "string",
      "minLength": 100,
      "description": "Markdown content with instructions"
    }
  }
}
